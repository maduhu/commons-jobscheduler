<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="scheduler_job_documentation_v1.1.xsl"?>
<description xmlns="http://www.sos-berlin.com/schema/scheduler_job_documentation_v1.1" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sos-berlin.com/schema/scheduler_job_documentation_v1.1 http://www.sos-berlin.com/schema/scheduler_job_documentation_v1.1.xsd">
  <job name="LogAnalyser" title="Analysing Scheduler Logfile" order="no" tasks="1">
    <script language="java" java_class="sos.scheduler.logMessage.JobSchedulerLogAnalyser" />
  </job>
  <releases>
    <release created="2009-12-15" modified="2009-12-15" id="First deployment">
      <title />
      <author name="Uwe Risse" email="uwe.risse@sos-berlin.com" />
    </release>
  </releases>
  <resources>
    <database required="true" name="SCHEDULER">
      <resource type="table" name="SCHEDULER_MESSAGES">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Die Tabelle SCHEDULER_MESSAGES hat diese Felder:

"MESSAGE_ID" NUMBER(9,0) NOT NULL, 
"SCHEDULER_ID" VARCHAR2(100 BYTE) NOT NULL, 
"CLUSTER_MEMBER_ID" VARCHAR2(100 BYTE) NOT NULL, 
"LOGFILE" VARCHAR2(255 BYTE) NOT NULL, 
"SEVERITY" VARCHAR2(20 BYTE) NOT NULL, 
"LOGTIME" DATE NOT NULL, 
"JOB_CHAIN" VARCHAR2(255 BYTE) NOT NULL, 
"ORDER_ID" VARCHAR2(255 BYTE) NOT NULL, 
"JOB_NAME" VARCHAR2(255 BYTE) NOT NULL, 
"TASK" NUMBER(9,0) DEFAULT 0 NOT NULL, 
"LOG" CLOB NOT NULL, 
"REFERENCE_MESSAGE_ID" NUMBER(9,0), 
"STATUS" NUMBER(9,0), 
"CREATION_DATE" DATE DEFAULT SYSDATE, 
"CNT" NUMBER(9,0), 

In der Datei scheduler_loganalyser.sql im jeweiligen DB-Ordner befindet sich das Script zum Einrichten der Tabelle.

Der Inhalt der Tabelle kann in der Konsole angesehen werden. Sie dient auch als Datenbasis für das Nagios Job Scheduler Plugin</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">The table SCHEDULER_MESSAGES has these fields:

"MESSAGE_ID" NUMBER(9,0) NOT NULL, 
"SCHEDULER_ID" VARCHAR2(100 BYTE) NOT NULL, 
"CLUSTER_MEMBER_ID" VARCHAR2(100 BYTE) NOT NULL, 
"LOGFILE" VARCHAR2(255 BYTE) NOT NULL, 
"SEVERITY" VARCHAR2(20 BYTE) NOT NULL, 
"LOGTIME" DATE NOT NULL, 
"JOB_CHAIN" VARCHAR2(255 BYTE) NOT NULL, 
"ORDER_ID" VARCHAR2(255 BYTE) NOT NULL, 
"JOB_NAME" VARCHAR2(255 BYTE) NOT NULL, 
"TASK" NUMBER(9,0) DEFAULT 0 NOT NULL, 
"LOG" CLOB NOT NULL, 
"REFERENCE_MESSAGE_ID" NUMBER(9,0), 
"STATUS" NUMBER(9,0), 
"CREATION_DATE" DATE DEFAULT SYSDATE, 
"CNT" NUMBER(9,0), 

In the file scheduler_loganalyser.sql you can find the script to create the table.

The contens of the table kann be seen in the "Console". It is also used for the nagios Job Scheduler Plugin.</div>
        </note>
      </resource>
    </database>
    <file os="all" type="java" file="sos.scheduler.jar" />
    <file os="all" type="java" file="sos.spooler.jar" />
    <file os="all" type="java" file="sos.connection.jar" />
    <file os="all" type="java" file="sos.util.jar" />
    <file os="all" type="java" file="sos.setting.jar" />
  </resources>
  <configuration>
    <params id="job_parameter">
      <param name="db" required="true">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Eine JDBC Verbindungsfolge.

Beispiel für Oracle:
jdbc -class=oracle.jdbc.driver.OracleDriver jdbc:oracle:thin:@dbHost:1521:database -user=scheduler -password=scheduler</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">A JDBC connection string

Sample for Oracle:
jdbc -class=oracle.jdbc.driver.OracleDriver jdbc:oracle:thin:@dbHost:1521:database -user=scheduler -password=scheduler</div>
        </note>
      </param>
      <param name="db_class" required="true">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Klasse für die Verbindung zu einer Daten via SOS Connection.

Mögliche Werte:

SOSOracleConnection
SOSMySQLConnection
SOSMSSQLConnection
SOSPgSQLConnection
SOSDB2Connection
SOSSybaseConnection</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">Class for the connection to a database via SOS Connection.

Possible Values:

SOSOracleConnection
SOSMySQLConnection
SOSMSSQLConnection
SOSPgSQLConnection
SOSDB2Connection
SOSSybaseConnection</div>
        </note>
      </param>
      <param name="type" required="false" default_value="status">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Der Job kann zwei Aufruftypen

status: Analysiert das Logfile und schreibt das Ergebnis in eine Datenbank.
reset: Setzt alle Meldungen zurück. Sie werden dann nicht mehr in der Anzeige der Meldungen berücksichtigt.</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">The Job has two type of calls

status: Analyses the logfile and saves the result in the database.
reset: Resets all messages so they will not be used again.</div>
        </note>
      </param>
      <param name="maximum_lifetime" required="false">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Meldungen, die älter als die hier angegebene Zeit sind, werden nicht berücksichtigt.

hh:mm:ss</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">Messages which are older than this time are ignored.

hh:mm:ss</div>
        </note>
      </param>
      <param name="log_messages" default_value="false" required="false">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Wenn dieser Schalter auf TRUE gesetzt wird, werden die analysierten Log-Einträge mit WARN oder ERROR in das Job-Protokoll geschrieben.</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">If TRUE, the errors and warnings will be written into the job log</div>
        </note>
      </param>
      <param name="log_file" default_value="logs/scheduler.log" required="false">
        <note language="de">
          <div xmlns="http://www.w3.org/1999/xhtml">Der Name der zu untersuchenden Datei. Wenn leer, wird das Log des Schedulers in logs/scheduler.log verwendet.</div>
        </note>
        <note language="en">
          <div xmlns="http://www.w3.org/1999/xhtml">The name of the logfile. If empty, the schedulers main log in log/scheduler.log will be used.</div>
        </note>
      </param>
    </params>
  </configuration>
  <documentation language="de">
    <div xmlns="http://www.w3.org/1999/xhtml">Dieser Job analysiert das Scheduler Log-File und schreibt die Fehler und Warnungen in die Datenbanktabelle SCHEDULER_MESSAGES. 

Die Tabelle wird bei der Installation ab der Version 1.3.7 automatisch eingerichtet. Falls die Tabelle fehlt, kann sie mit einem aktuellen Scheduler Update eingerichtet werden.

Wenn der Job mit dem Parameter type=reset aufgerufen wird, werden die vorhandenen Meldungen auf den Status -1 gesetzt. Diese Meldungen werden von der Konsole und dem Nagios Plugin dann nicht mehr berücksichtigt.

Die Tabelle SCHEDULER_MESSAGES dient als Datenbasis für das Job Scheduler Nagios Plugin:

Die Installationsdateien für das Plugin können auf www.sos-berlin.com heruntergeladen werden.

www.sos-berlin.com/downloads/loganalyser.zip</div>
  </documentation>
</description>

